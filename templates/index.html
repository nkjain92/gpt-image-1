<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>OpenAI Image Generation & Editing</title>
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial,
          sans-serif;
        margin: 2em auto;
        max-width: 700px;
        padding: 0 1em;
        background-color: #f8f9fa;
        color: #343a40;
        line-height: 1.6;
      }
      .container {
        background: #ffffff;
        padding: 2em;
        border-radius: 8px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
        margin-top: 2em;
      }
      h1 {
        text-align: center;
        color: #495057;
        margin-bottom: 1em;
      }
      form div {
        margin-bottom: 1.2em;
      }
      label {
        display: block;
        margin-bottom: 0.5em;
        font-weight: bold;
        color: #495057;
      }
      input[type='text'],
      textarea,
      select,
      input[type='file'] {
        width: 100%;
        padding: 0.8em;
        margin-bottom: 0.5em;
        border: 1px solid #ced4da;
        border-radius: 4px;
        box-sizing: border-box;
        font-size: 1em;
      }
      textarea {
        min-height: 100px;
        resize: vertical;
      }
      input[type='file'] {
        padding: 0.5em;
      }
      button {
        background-color: #007bff;
        color: white;
        padding: 0.8em 1.5em;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 1em;
        transition: background-color 0.3s ease;
        width: 100%;
        margin-top: 0.5em;
      }
      button:hover {
        background-color: #0056b3;
      }
      .result {
        margin-top: 2em;
        text-align: center;
      }
      .result h2 {
        color: #495057;
        margin-bottom: 0.8em;
      }
      .result img {
        max-width: 100%;
        height: auto;
        margin-top: 0.5em;
        border: 1px solid #dee2e6;
        border-radius: 4px;
        background-color: #fff;
      }
      .flash-messages {
        list-style: none;
        padding: 0;
        margin-bottom: 1.5em;
      }
      .flash-messages li {
        padding: 0.8em 1.2em;
        margin-bottom: 0.8em;
        border-radius: 4px;
        border: 1px solid transparent;
      }
      .flash-messages .success,
      .flash-messages .info {
        background-color: #d1e7dd;
        color: #0f5132;
        border-color: #badbcc;
      }
      .flash-messages .info {
        background-color: #cff4fc;
        color: #055160;
        border-color: #b6effb;
      }
      .flash-messages .error {
        background-color: #f8d7da;
        color: #842029;
        border-color: #f5c2c7;
      }
      .flash-messages .warning {
        background-color: #fff3cd;
        color: #664d03;
        border-color: #ffecb5;
      }
      select {
        appearance: none;
        background: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%27http%3A//www.w3.org/2000/svg%27%20width%3D%27292.4%27%20height%3D%27292.4%27%3E%3Cpath%20fill%3D%27%23007bff%27%20d%3D%27M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%27/%3E%3C/svg%3E')
          no-repeat right 0.8em center/1em;
      }
      .mode-selection label {
        display: inline-block;
        margin-right: 1em;
        font-weight: normal;
      }
      .hidden {
        display: none;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>GPT Image Generation & Editing</h1>

      {% with messages = get_flashed_messages(with_categories=true) %} {% if messages %}
      <ul class="flash-messages">
        {% for category, message in messages %}
        <li class="{{ category }}">{{ message }}</li>
        {% endfor %}
      </ul>
      {% endif %} {% endwith %}

      <form action="{{ url_for('process_image') }}" method="post" enctype="multipart/form-data">
        <div class="mode-selection">
          <label>
            <input
              type="radio"
              name="mode"
              value="generate"
              checked
              onchange="updateFormDisplay()"
            />
            Generate New
          </label>
          <label>
            <input type="radio" name="mode" value="edit_reference" onchange="updateFormDisplay()" />
            Edit (Reference Images)
          </label>
          <label>
            <input
              type="radio"
              name="mode"
              value="edit_inpainting"
              onchange="updateFormDisplay()"
            />
            Edit (Inpainting)
          </label>
        </div>

        <hr style="margin: 1.5em 0" />

        <div>
          <label for="prompt">Prompt:</label>
          <textarea
            id="prompt"
            name="prompt"
            placeholder="Describe the image you want to generate or edit..."
            required
          ></textarea>
        </div>

        <div id="reference-inputs" class="hidden">
          <label for="reference_images">Reference Image(s):</label>
          <input
            type="file"
            id="reference_images"
            name="reference_images"
            multiple
            accept="image/png, image/jpeg, image/webp"
          />
          <small>Select one or more images to guide the generation.</small>
        </div>

        <div id="inpainting-inputs" class="hidden">
          <div>
            <label for="inpainting_image">Image to Edit:</label>
            <input
              type="file"
              id="inpainting_image"
              name="inpainting_image"
              accept="image/png, image/jpeg, image/webp"
            />
          </div>
          <div>
            <label for="inpainting_mask">Mask:</label>
            <input type="file" id="inpainting_mask" name="inpainting_mask" accept="image/png" />
            <small
              >Upload a PNG mask with transparent areas indicating where edits should occur. Must be
              the same size as the image.</small
            >
          </div>
        </div>

        <div id="common-options">
          <hr style="margin: 1.5em 0" />
          <h4>Options:</h4>
          <div>
            <label for="size">Size:</label>
            <select id="size" name="size">
              <option value="1024x1024" selected>1024x1024 (Default)</option>
              <option value="1024x1536">1024x1536 (Portrait)</option>
              <option value="1536x1024">1536x1024 (Landscape)</option>
            </select>
          </div>

          <div id="generate-options" class="hidden">
            <div>
              <label for="quality">Quality (Generation Only):</label>
              <select id="quality" name="quality">
                <option value="standard" selected>Standard (Default)</option>
                <option value="hd">HD</option>
              </select>
              <small>Higher quality may take longer and cost more.</small>
            </div>

            <div>
              <label for="background">Background (Generation Only):</label>
              <select id="background" name="background">
                <option value="opaque" selected>Opaque (Default)</option>
                <option value="transparent">Transparent (Requires PNG output)</option>
              </select>
              <small>Transparency only works with PNG format.</small>
            </div>
          </div>
        </div>

        <button type="submit">Process Image</button>
      </form>

      {% if result_image_url %}
      <div class="result">
        <h2>Result Image:</h2>
        <img src="{{ result_image_url }}" alt="Result Image" />
      </div>
      {% endif %}
    </div>

    <script>
      function updateFormDisplay() {
        const mode = document.querySelector('input[name="mode"]:checked').value;
        const referenceInputs = document.getElementById('reference-inputs');
        const inpaintingInputs = document.getElementById('inpainting-inputs');
        const generateOptions = document.getElementById('generate-options');

        referenceInputs.classList.add('hidden');
        inpaintingInputs.classList.add('hidden');
        generateOptions.classList.add('hidden');

        if (mode === 'generate') {
          generateOptions.classList.remove('hidden');
        } else if (mode === 'edit_reference') {
          referenceInputs.classList.remove('hidden');
        } else if (mode === 'edit_inpainting') {
          inpaintingInputs.classList.remove('hidden');
        }
      }

      document.addEventListener('DOMContentLoaded', updateFormDisplay);
    </script>
  </body>
</html>
